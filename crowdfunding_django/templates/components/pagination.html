{% load static %}

<!-- Pagination component for paginated content -->
{% if is_paginated and page_obj %}
    <nav class="pagination-nav" aria-label="Pagination Navigation">
        <div class="pagination-info">
            <span class="pagination-summary">
                Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} 
                of {{ page_obj.paginator.count }} results
            </span>
        </div>
        
        <ul class="pagination">
            <!-- First page link -->
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a href="?{% if request.GET.urlencode %}{{ request.GET.urlencode }}&{% endif %}page=1" 
                       class="page-link page-link-first"
                       aria-label="Go to first page"
                       title="First page">
                        <i class="fas fa-angle-double-left" aria-hidden="true"></i>
                        <span class="sr-only">First</span>
                    </a>
                </li>
                
                        <i class="fas fa-angle-double-right" aria-hidden="true"></i>
                        <span class="sr-only">Last</span>
                    </a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link page-link-next disabled" aria-hidden="true">
                        <i class="fas fa-angle-right" aria-hidden="true"></i>
                    </span>
                </li>
                <li class="page-item disabled">
                    <span class="page-link page-link-last disabled" aria-hidden="true">
                        <i class="fas fa-angle-double-right" aria-hidden="true"></i>
                    </span>
                </li>
            {% endif %}
        </ul>
        
        <!-- Page size selector (optional) -->
        {% if show_page_size_selector|default:False %}
            <div class="page-size-selector">
                <label for="page-size" class="page-size-label">Show:</label>
                <select id="page-size" class="page-size-select" onchange="updatePageSize(this.value)">
                    <option value="10" {% if request.GET.per_page == '10' %}selected{% endif %}>10</option>
                    <option value="25" {% if request.GET.per_page == '25' or not request.GET.per_page %}selected{% endif %}>25</option>
                    <option value="50" {% if request.GET.per_page == '50' %}selected{% endif %}>50</option>
                    <option value="100" {% if request.GET.per_page == '100' %}selected{% endif %}>100</option>
                </select>
                <span class="page-size-text">per page</span>
            </div>
        {% endif %}
    </nav>
{% endif %}

<style>
/* Pagination Styles */
.pagination-nav {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    margin: var(--spacing-xl) 0;
    padding: var(--spacing-lg) 0;
    border-top: 1px solid var(--gray-200);
}

.pagination-info {
    display: flex;
    justify-content: center;
    align-items: center;
}

.pagination-summary {
    color: var(--gray-600);
    font-size: var(--font-size-sm);
    font-weight: 500;
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: var(--spacing-xs);
}

.page-item {
    display: flex;
}

.page-link {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    padding: var(--spacing-sm);
    color: var(--primary-color);
    text-decoration: none;
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius);
    background-color: var(--white);
    font-size: var(--font-size-sm);
    font-weight: 500;
    transition: var(--transition);
    position: relative;
}

.page-link:hover {
    color: var(--primary-dark);
    background-color: var(--gray-100);
    border-color: var(--gray-400);
    text-decoration: none;
    transform: translateY(-1px);
    box-shadow: var(--shadow);
}

.page-link:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
    z-index: 1;
}

.page-item.active .page-link,
.current-page {
    color: var(--white);
    background-color: var(--primary-color);
    border-color: var(--primary-color);
    box-shadow: var(--shadow);
}

.page-item.active .page-link:hover,
.current-page:hover {
    color: var(--white);
    background-color: var(--primary-dark);
    border-color: var(--primary-dark);
    transform: none;
}

.page-item.disabled .page-link,
.page-link.disabled {
    color: var(--gray-400);
    background-color: var(--gray-100);
    border-color: var(--gray-300);
    cursor: not-allowed;
    opacity: 0.6;
}

.page-item.disabled .page-link:hover,
.page-link.disabled:hover {
    color: var(--gray-400);
    background-color: var(--gray-100);
    border-color: var(--gray-300);
    transform: none;
    box-shadow: none;
}

.ellipsis {
    color: var(--gray-500);
    background-color: transparent;
    border-color: transparent;
    cursor: default;
}

.ellipsis:hover {
    color: var(--gray-500);
    background-color: transparent;
    border-color: transparent;
    transform: none;
    box-shadow: none;
}

/* Navigation buttons */
.page-link-first,
.page-link-prev,
.page-link-next,
.page-link-last {
    font-size: 0.875rem;
}

/* Page size selector */
.page-size-selector {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-md);
}

.page-size-label,
.page-size-text {
    color: var(--gray-600);
    font-size: var(--font-size-sm);
}

.page-size-select {
    padding: var(--spacing-xs) var(--spacing-sm);
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius);
    background-color: var(--white);
    color: var(--gray-700);
    font-size: var(--font-size-sm);
    cursor: pointer;
    transition: var(--transition);
}

.page-size-select:hover {
    border-color: var(--primary-color);
}

.page-size-select:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
    border-color: var(--primary-color);
}

/* Screen reader only text */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Mobile responsive */
@media (max-width: 768px) {
    .pagination-nav {
        gap: var(--spacing-sm);
        margin: var(--spacing-lg) 0;
        padding: var(--spacing-md) 0;
    }
    
    .pagination {
        flex-wrap: wrap;
        gap: 4px;
    }
    
    .page-link {
        min-width: 36px;
        height: 36px;
        padding: var(--spacing-xs);
        font-size: 0.8rem;
    }
    
    .pagination-summary {
        text-align: center;
        font-size: 0.8rem;
    }
    
    .page-size-selector {
        flex-direction: column;
        gap: var(--spacing-xs);
    }
    
    /* Hide some page numbers on mobile */
    @media (max-width: 480px) {
        .pagination .page-item:not(.active):not(:first-child):not(:last-child):not(:nth-child(2)):not(:nth-last-child(2)) {
            display: none;
        }
        
        .pagination-info {
            order: 1;
        }
        
        .pagination {
            order: 2;
        }
        
        .page-size-selector {
            order: 3;
        }
    }
}

/* High contrast mode */
@media (prefers-contrast: high) {
    .page-link {
        border: 2px solid var(--gray-600);
    }
    
    .page-item.active .page-link {
        background-color: var(--gray-900);
        border-color: var(--gray-900);
    }
    
    .page-item.disabled .page-link {
        border-color: var(--gray-400);
    }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
    .page-link {
        transition: none;
    }
    
    .page-link:hover {
        transform: none;
    }
}

/* Print styles */
@media print {
    .pagination-nav {
        display: none;
    }
}
</style>

<script>
// Page size selector functionality
function updatePageSize(perPage) {
    const url = new URL(window.location);
    url.searchParams.set('per_page', perPage);
    url.searchParams.set('page', '1'); // Reset to first page
    window.location.href = url.toString();
}

// Keyboard navigation for pagination
document.addEventListener('DOMContentLoaded', function() {
    const pagination = document.querySelector('.pagination');
    if (!pagination) return;
    
    document.addEventListener('keydown', function(e) {
        // Only handle keyboard navigation when pagination is visible
        if (!pagination.offsetParent) return;
        
        const currentPage = pagination.querySelector('.page-item.active .page-link');
        if (!currentPage) return;
        
        let targetLink = null;
        
        switch(e.key) {
            case 'ArrowLeft':
                // Go to previous page
                targetLink = pagination.querySelector('.page-link-prev:not(.disabled)');
                break;
            case 'ArrowRight':
                // Go to next page
                targetLink = pagination.querySelector('.page-link-next:not(.disabled)');
                break;
            case 'Home':
                // Go to first page
                targetLink = pagination.querySelector('.page-link-first:not(.disabled)');
                break;
            case 'End':
                // Go to last page
                targetLink = pagination.querySelector('.page-link-last:not(.disabled)');
                break;
        }
        
        if (targetLink && e.target.tagName !== 'INPUT' && e.target.tagName !== 'SELECT') {
            e.preventDefault();
            targetLink.click();
        }
    });
});
</script>