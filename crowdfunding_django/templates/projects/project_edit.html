{% extends 'base.html' %} {% load static %} {% block extra_css %}
<style>
  .edit-project-container {
    max-width: 800px;
    margin: 2rem auto;
    background: var(--white);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
  }
{% extends 'base.html' %}
{% load static %}

{% block content %}
  <div class="edit-project-container">
    <h2>Edit Project</h2>
    <form id="edit-project-form" method="post" action="">
      {% csrf_token %}
      {{ form.as_p }}

      <div class="form-actions">
        <button type="submit" class="btn btn-warning">Update Project</button>
        <a href="{% url 'projects:detail' project.pk %}" class="cancel-link">Cancel</a>
      </div>
    </form>
  </div>

  {% include 'components/loading.html' with id='edit-project-loading' hidden=True %}
{% endblock %}

{% block extra_js %}
<script>
  // Minimal client-side helpers only: no AJAX.
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('edit-project-form');
    if (!form) return;

    form.addEventListener('submit', function(e) {
      const targetInput = form.querySelector('input[name="total_target"]');
      const currentAmount = {{ project.current_amount|default:0 }};
      if (targetInput && parseFloat(targetInput.value) < currentAmount) {
        if (!confirm('Warning: The new target is less than the amount already raised. Are you sure you want to continue?')) {
          e.preventDefault();
          return;
        }
      }

      // show simple loading if available
      try {
        if (typeof showLoading === 'function') {
          showLoading(form.querySelector('[type="submit"]') || form);
        } else {
          const loading = document.getElementById('edit-project-loading');
          if (loading) loading.style.display = '';
        }
      } catch (err) {
        // ignore
      }
      // allow normal POST to proceed
    });
  });
</script>
{% endblock %}
                {% for error in form.start_date.errors %}
