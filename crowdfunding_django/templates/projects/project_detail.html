{% extends 'base.html' %} {% load static %} {% block title %}{{ project.title }}
| CrowdFund{% endblock %} {# Styles moved to static/css/main.css to avoid
duplication and reduce template size #} {% block content %}
<section class="project-hero">
  <div class="container">
    <span
      class="project-status-badge status-{{ project.campaign_status|lower }}"
    >
      {{ project.campaign_status }}
    </span>
    <h1 class="project-title">{{ project.title }}</h1>
    <p>
      Created by {{ project.owner.get_full_name|default:project.owner.email }}
    </p>
  </div>
</section>

<div class="project-detail-container">
  <article class="project-main">
    <div class="project-description">{{ project.details|linebreaks }}</div>

    <div class="project-meta-grid">
      <div class="meta-card">
        <span class="meta-label">Target</span>
        <span class="meta-value"
          >${{ project.total_target|floatformat:0 }}</span
        >
      </div>
      <div class="meta-card">
        <span class="meta-label">Raised</span>
        <span class="meta-value"
          >${{ project.current_amount|floatformat:0 }}</span
        >
      </div>
      <div class="meta-card">
        <span class="meta-label">Backers</span>
        <span class="meta-value">{{ project.total_contributions }}</span>
      </div>
      <div class="meta-card">
        <span class="meta-label">Days Left</span>
        <span class="meta-value">{{ project.days_left }}</span>
      </div>
    </div>

    {% if contributions %}
    <section class="contributions-section">
      <div
        class="section-header"
        style="
          padding: 1.25rem 1.5rem;
          border-bottom: 1px solid var(--gray-200);
        "
      >
        <h2
          style="
            margin: 0;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 0.5rem;
          "
        >
          <i class="fas fa-heart"></i>
          Recent Contributions
        </h2>
      </div>
      <div class="contributions-list">
        {% for contribution in contributions %}
        <div class="contribution-item">
          <div class="contributor-info">
            <div class="contributor-avatar">
              {{
              contribution.contributor.first_name|default:contribution.contributor.email|slice:':1'|upper
              }}
            </div>
            <div>
              <strong
                >{{ contribution.contributor.get_full_name|default:"Anonymous"
                }}</strong
              >
              <div class="text-muted">
                {{ contribution.contributed_at|date:"F d, Y g:i A" }}
              </div>
            </div>
          </div>
          <div class="contribution-amount">
            ${{ contribution.amount|floatformat:0 }}
          </div>
        </div>
        {% endfor %}
      </div>
    </section>
    {% endif %}
  </article>

  <aside class="project-sidebar">
    <div class="funding-summary">
      <p class="funding-amount">${{ project.current_amount|floatformat:0 }}</p>
      <p class="funding-target">
        of ${{ project.total_target|floatformat:0 }} goal
      </p>
    </div>

    <div class="progress-bar">
      <div
        class="progress-fill"
        style="width: {{ progress_percent|floatformat:0 }}%"
      ></div>
    </div>
    <p
      style="text-align: center; font-weight: 600; color: var(--primary-color)"
    >
      {{ progress_percent|floatformat:0 }}% funded
    </p>

    <div class="owner-summary">
      <div class="owner-avatar">
        {{ project.owner.first_name|default:project.owner.email|slice:':1'|upper
        }}
      </div>
      <div>
        <div style="font-weight: 600">
          {{ project.owner.get_full_name|default:project.owner.email }}
        </div>
        <div class="text-muted">Project owner</div>
      </div>
    </div>

    {% if project.is_active and project.owner != user %}
    <form
      method="post"
      action="{% url 'projects:contribute' project.pk %}"
      class="contribute-form"
    >
      {% csrf_token %}
      <div class="quick-amounts">
        <button type="button" class="quick-amount" data-amount="50">$50</button>
        <button type="button" class="quick-amount" data-amount="100">
          $100
        </button>
        <button type="button" class="quick-amount" data-amount="250">
          $250
        </button>
      </div>
      <input
        type="number"
        name="amount"
        min="1"
        step="1"
        required
        class="amount-input"
        placeholder="Enter amount (EGP)"
      />
      <textarea
        name="message"
        rows="3"
        class="form-control"
        placeholder="Leave a message (optional)"
      ></textarea>
      <button type="submit" class="btn-contribute">
        <i class="fas fa-heart"></i>
        Back this project
      </button>
    </form>
    {% elif project.owner == user %}
    <div class="project-actions">
      <p class="text-muted">You are the owner of this project.</p>
      <a
        href="{% url 'projects:edit' project.pk %}"
        class="btn-action btn-edit"
      >
        <i class="fas fa-edit"></i>
        Edit project
      </a>
      <a
        href="{% url 'projects:delete' project.pk %}"
        class="btn-action btn-delete"
        onclick="return confirm('Are you sure you want to delete this project?')"
      >
        <i class="fas fa-trash"></i>
        Delete project
      </a>
    </div>
    {% else %}
    <p class="text-muted" style="text-align: center">
      {% if project.campaign_status == 'Ended' %} This campaign has ended. {%
      else %}
      <a href="{% url 'accounts:login' %}">Log in</a> to support this project.
      {% endif %}
    </p>
    {% endif %}
  </aside>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const quickButtons = document.querySelectorAll(".quick-amount");
    const amountInput = document.querySelector(".amount-input");

    quickButtons.forEach(function (button) {
      button.addEventListener("click", function () {
        if (amountInput) {
          amountInput.value = this.dataset.amount;
          amountInput.focus();
        }
      });
    });
  });
</script>
{% endblock %}
